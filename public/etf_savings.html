<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETF-Sparplan Rechner</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/main.css">
    <script type="module" src="js/app.js"></script>
    <script>
        // Debug script to check if JavaScript is working
        console.log('=== DEBUG: Basic JavaScript is working ===');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== DEBUG: DOM Content Loaded ===');
            
            // Test if basic elements exist
            const budgetBtn = document.getElementById('budgetPhase');
            const saveProfileBtn = document.getElementById('saveProfile');
            
            console.log('Budget button exists:', !!budgetBtn);
            console.log('Save profile button exists:', !!saveProfileBtn);
            
            // Test if window.profileManager exists
            setTimeout(() => {
                console.log('window.profileManager exists:', !!window.profileManager);
                if (window.profileManager) {
                    console.log('profileManager functions:', Object.keys(window.profileManager));
                }
                
                // Test button functionality
                if (budgetBtn) {
                    console.log('Adding test listener to budget button');
                    budgetBtn.addEventListener('click', function() {
                        console.log('=== DEBUG: Budget button clicked ===');
                    });
                }
                
                if (saveProfileBtn) {
                    console.log('Adding test listener to save profile button');
                    saveProfileBtn.addEventListener('click', function() {
                        console.log('=== DEBUG: Save profile button clicked ===');
                    });
                }
            }, 1000);
        });
        
        // Log any errors
        window.addEventListener('error', function(e) {
            console.error('=== JavaScript Error ===', e.error, e.filename, e.lineno);
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Finanzielle Zukunftsplanung</h1>
            <p>Komplette Finanzplanung - von der Budgetierung √ºber die Geldanlage bis zur Rente</p>
            
            <!-- Main Planning Phases -->
            <div class="planning-section">
                <h3>üìä Finanzplanung & ETF-Investment</h3>
                            <div class="phase-toggle main-phases">
                <button class="phase-button" id="budgetPhase">üíº Budgetplanung</button>
                <button class="phase-button active" id="accumulationPhase">üìà Ansparphase</button>
                <button class="phase-button" id="withdrawalPhase">üèñÔ∏è Entnahmephase</button>
                <button class="phase-button" id="scenarioComparisonPhase">üìä Szenario-Vergleich</button>
            </div>
            </div>


            <!-- Separate Tax Calculator -->
            <div class="tax-section">
                <h3>üá©üá™ Steuerrechner</h3>
                <div class="phase-toggle tax-calculator">
                    <button class="phase-button" id="taxCalculatorPhase">üßÆ Deutscher Steuer- & Gehaltsrechner</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Budget Planning Section -->
            <div class="budget-section" id="budgetSection" style="display: none;">
                <h2 class="section-title">üí∞ Pers√∂nliche Budgetplanung</h2>
                
                <!-- Profile Controls -->
                <div class="profile-controls">
                    <button class="profile-button" id="saveProfile">üíæ Profil speichern</button>
                    <button class="profile-button" id="manageProfiles">üóÇÔ∏è Profile verwalten</button>
                    <button class="profile-button" id="resetBudget">üîÑ Zur√ºcksetzen</button>
                </div>

                <div class="budget-grid">
                    <!-- Income Section -->
                    <div class="expense-category">
                        <div class="category-header">
                            <h4 class="category-title">üíº Einkommen</h4>
                            <div class="period-toggle" id="incomePeriodToggle">
                                <button class="period-option active" data-period="monthly">Monatlich</button>
                                <button class="period-option" data-period="yearly">J√§hrlich</button>
                            </div>
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Netto-Gehalt</span>
                            <input type="text" class="expense-input" id="salary" value="3.500" step="50">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Nebeneinkommen</span>
                            <input type="text" class="expense-input" id="sideIncome" value="0" step="50">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Sonstige Eink√ºnfte</span>
                            <input type="text" class="expense-input" id="otherIncome" value="0" step="50">
                        </div>
                        <div class="category-total">
                            Summe Einkommen: <span class="amount" id="incomeTotal">‚Ç¨3.500,00</span>
                        </div>
                    </div>

                    <!-- Fixed Expenses -->
                    <div class="expense-category">
                        <div class="category-header">
                            <h4 class="category-title">üè† Fixkosten</h4>
                            <div class="period-toggle" id="fixedPeriodToggle">
                                <button class="period-option active" data-period="monthly">Monatlich</button>
                                <button class="period-option" data-period="yearly">J√§hrlich</button>
                            </div>
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Miete/Hypothek</span>
                            <input type="text" class="expense-input" id="rent" value="1.200" step="50">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Nebenkosten</span>
                            <input type="text" class="expense-input" id="utilities" value="150" step="10">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Krankenkasse</span>
                            <input type="text" class="expense-input" id="health" value="180" step="10">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Versicherungen</span>
                            <input type="text" class="expense-input" id="insurance" value="120" step="10">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Internet/Telefon</span>
                            <input type="text" class="expense-input" id="internet" value="45" step="5">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">GEZ</span>
                            <input type="text" class="expense-input" id="gez" value="18" step="1">
                        </div>
                        <div class="category-total">
                            Summe Fixkosten: <span class="amount" id="fixedTotal">‚Ç¨1.713,00</span>
                        </div>
                    </div>

                    <!-- Variable Expenses -->
                    <div class="expense-category">
                        <div class="category-header">
                            <h4 class="category-title">üõí Variable Kosten</h4>
                            <div class="period-toggle" id="variablePeriodToggle">
                                <button class="period-option active" data-period="monthly">Monatlich</button>
                                <button class="period-option" data-period="yearly">J√§hrlich</button>
                            </div>
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Lebensmittel</span>
                            <input type="text" class="expense-input" id="food" value="400" step="25">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Transport/Auto</span>
                            <input type="text" class="expense-input" id="transport" value="200" step="25">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Freizeit</span>
                            <input type="text" class="expense-input" id="leisure" value="250" step="25">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Kleidung</span>
                            <input type="text" class="expense-input" id="clothing" value="100" step="25">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Abonnements</span>
                            <input type="text" class="expense-input" id="subscriptions" value="50" step="5">
                        </div>
                        <div class="expense-item">
                            <span class="expense-label">Sonstiges</span>
                            <input type="text" class="expense-input" id="miscellaneous" value="100" step="25">
                        </div>
                        <div class="category-total">
                            Summe Variable Kosten: <span class="amount" id="variableTotal">‚Ç¨1.100,00</span>
                        </div>
                    </div>
                </div>

                <!-- Budget Summary -->
                <div class="budget-summary">
                    <h3>üìä Budget-√úbersicht</h3>
                    <div class="income-display">
                        Einkommen: <span id="totalIncome">‚Ç¨3.500</span>
                    </div>
                    <div class="expenses-display">
                        Ausgaben: <span id="totalExpenses">‚Ç¨2.863</span>
                    </div>
                    <div class="remaining-display">
                        Verf√ºgbar: <span id="remainingBudget">‚Ç¨637</span>
                    </div>

                    <!-- Budget Pie Chart -->
                    <div class="budget-chart-container" style="margin-top: 30px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h4 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">üí∞ Budget-Verteilung</h4>
                        <div style="height: 300px; position: relative;">
                            <canvas id="budgetPieChart"></canvas>
                        </div>
                    </div>

                    <!-- Savings Allocation -->
                    <div class="savings-allocation">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">üí∞ Sparrate festlegen</h4>
                        
                        <div class="allocation-controls">
                            <div class="allocation-toggle">
                                <button class="allocation-option active" id="fixedAmount">Fester Betrag</button>
                                <button class="allocation-option" id="percentage">Prozentsatz</button>
                            </div>
                            
                            <div id="fixedAmountControl">
                                <input type="text" id="savingsAmount" class="input-field" value="500" step="50" style="width: 120px;">
                                <span style="margin-left: 10px;">‚Ç¨</span>
                            </div>
                            
                            <div id="percentageControl" style="display: none;">
                                <div class="slider-container" style="width: 200px;">
                                    <input type="range" id="savingsPercentage" class="slider" min="0" max="100" value="50" step="5">
                                    <span class="slider-value" id="savingsPercentageValue">50%</span>
                                </div>
                            </div>
                        </div>

                        <div class="savings-result">
                            Monatliche ETF-Sparrate: <span id="finalSavingsAmount">‚Ç¨500</span>
                        </div>

                        <button id="applySavingsRate" style="margin-top: 15px; padding: 12px 24px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; width: 100%;">
                            üìà Sparrate in Ansparphase √ºbernehmen
                        </button>
                    </div>
                </div>
            </div>

            <!-- German Tax Calculator Section -->
            <div class="tax-calculator-section" id="taxCalculatorSection" style="display: none;">
                <h2 class="section-title">üá©üá™ Deutscher Steuer- & Gehaltsrechner</h2>
                
                <div class="tax-info-box" style="background: #e8f4fd; border: 2px solid #3498db; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">‚ÑπÔ∏è √úber diesen Rechner</h3>
                    <p style="color: #34495e; margin-bottom: 10px;">Dieser Rechner basiert auf den aktuellen deutschen Steuers√§tzen f√ºr 2025 und berechnet Ihr Netto-Einkommen nach Abzug aller Steuern und Sozialabgaben.</p>
                    <p style="color: #34495e; margin-bottom: 10px;"><strong>Ber√ºcksichtigt werden:</strong> Einkommensteuer, Kirchensteuer, Krankenversicherung, Pflegeversicherung, Rentenversicherung und Arbeitslosenversicherung.</p>
                    <p style="color: #34495e;"><strong>Hinweis:</strong> Diese Berechnung ist eine Sch√§tzung. F√ºr eine genaue Berechnung konsultieren Sie bitte einen Steuerberater.</p>
                </div>

                <div class="tax-calculator-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                    <!-- Tax Input Section -->
                    <div class="controls-section">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">Eingaben</h3>
                        
                        <div class="input-group">
                            <label for="grossSalary">Brutto-Jahresgehalt (‚Ç¨)</label>
                            <input type="text" id="grossSalary" class="input-field" value="60.000" step="1000">
                        </div>

                        <div class="input-group">
                            <label for="taxClass">Steuerklasse</label>
                            <select id="taxClass" class="input-field" style="width: 100%;">
                                <option value="1">Klasse I - Ledig, keine Kinder</option>
                                <option value="2">Klasse II - Alleinerziehend</option>
                                <option value="3">Klasse III - Verheiratet, h√∂heres Einkommen</option>
                                <option value="4">Klasse IV - Verheiratet, √§hnliches Einkommen</option>
                                <option value="5">Klasse V - Verheiratet, niedrigeres Einkommen</option>
                                <option value="6">Klasse VI - Zweitjob</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="federalState">Bundesland</label>
                            <select id="federalState" class="input-field" style="width: 100%;">
                                <option value="bw">Baden-W√ºrttemberg</option>
                                <option value="by">Bayern</option>
                                <option value="be">Berlin</option>
                                <option value="bb">Brandenburg</option>
                                <option value="hb">Bremen</option>
                                <option value="hh">Hamburg</option>
                                <option value="he">Hessen</option>
                                <option value="mv">Mecklenburg-Vorpommern</option>
                                <option value="ni">Niedersachsen</option>
                                <option value="nw" selected>Nordrhein-Westfalen</option>
                                <option value="rp">Rheinland-Pfalz</option>
                                <option value="sl">Saarland</option>
                                <option value="sn">Sachsen</option>
                                <option value="st">Sachsen-Anhalt</option>
                                <option value="sh">Schleswig-Holstein</option>
                                <option value="th">Th√ºringen</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="age">Alter</label>
                            <input type="number" id="age" class="input-field" value="30" min="16" max="99">
                        </div>

                        <div class="input-group">
                            <label for="children">Anzahl Kinder</label>
                            <input type="number" id="children" class="input-field" value="0" min="0" max="10">
                        </div>

                        <div class="toggle-container">
                            <label>Kirchensteuerpflichtig</label>
                            <div class="toggle" id="churchTaxToggle"></div>
                        </div>

                        <div class="toggle-container">
                            <label>Gesetzlich krankenversichert</label>
                            <div class="toggle active" id="publicHealthInsuranceToggle"></div>
                        </div>

                        <div class="input-group" id="healthInsuranceRateGroup">
                            <label for="healthInsuranceRate">Zusatzbeitrag Krankenkasse (%)</label>
                            <div class="slider-container">
                                <input type="range" id="healthInsuranceRate" class="slider" min="0.5" max="3.5" value="2.5" step="0.1">
                                <span class="slider-value" id="healthInsuranceRateValue">2.5%</span>
                            </div>
                        </div>


                    </div>

                    <!-- Tax Results Section -->
                    <div class="results-section">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">Berechnungsergebnisse</h3>
                        
                        <div class="results-grid" style="grid-template-columns: 1fr;">
                            <div class="result-card">
                                <h3>Brutto-Monatsgehalt</h3>
                                <div class="result-value" id="grossMonthlySalary">‚Ç¨5.000</div>
                            </div>
                            <div class="result-card">
                                <h3>Netto-Monatsgehalt</h3>
                                <div class="result-value" id="netMonthlySalary">‚Ç¨3.200</div>
                            </div>
                            <div class="result-card">
                                <h3>Netto-Jahresgehalt</h3>
                                <div class="result-value" id="netYearlySalary">‚Ç¨38.400</div>
                            </div>
                            <div class="result-card">
                                <h3>Gesamte Abz√ºge</h3>
                                <div class="result-value" id="totalDeductions">‚Ç¨21.600</div>
                            </div>
                        </div>

                        <!-- Detailed Breakdown -->
                        <div style="background: white; padding: 20px; border-radius: 12px; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">Aufschl√ºsselung der Abz√ºge</h4>
                            <div class="deduction-item" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Einkommensteuer:</span>
                                <span id="incomeTax">‚Ç¨0</span>
                            </div>

                            <div class="deduction-item" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Kirchensteuer:</span>
                                <span id="churchTax">‚Ç¨0</span>
                            </div>
                            <div class="deduction-item" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Krankenversicherung:</span>
                                <span id="healthInsurance">‚Ç¨0</span>
                            </div>
                            <div class="deduction-item" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Pflegeversicherung:</span>
                                <span id="careInsurance">‚Ç¨0</span>
                            </div>
                            <div class="deduction-item" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Rentenversicherung:</span>
                                <span id="pensionInsurance">‚Ç¨0</span>
                            </div>
                            <div class="deduction-item" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Arbeitslosenversicherung:</span>
                                <span id="unemploymentInsurance">‚Ç¨0</span>
                            </div>
                        </div>

                        <!-- Integration Button -->
                        <button id="useTaxCalculatorResults" style="margin-top: 20px; padding: 12px 24px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; width: 100%;">
                            üìä Brutto-Gehalt in ETF-Rechner √ºbernehmen
                        </button>
                    </div>
                </div>
            </div>

            <div class="top-section">
                <!-- Controls Section -->
                <div class="controls-section">
                    <h2 class="section-title">Investitionsparameter</h2>

                    <!-- Ansparphase Scenario Controls -->
                    <div class="scenario-controls">
                        <button class="scenario-button" id="saveAnsparphaseScenario">üíæ Szenario speichern</button>
                        <button class="scenario-button" id="manageAnsparphaseScenarios">üóÇÔ∏è Szenarien verwalten</button>
                        <button class="scenario-button" id="resetAnsparphaseScenario">üîÑ Zur√ºcksetzen</button>
                    </div>

                    <!-- Scenario Tabs -->
                    <div class="scenario-tabs" id="scenarioTabs">
                        <button class="scenario-tab active" data-scenario="A">üìà Szenario A</button>
                        <button class="add-scenario-btn" id="addScenarioBtn" title="Neues Szenario hinzuf√ºgen">‚ûï</button>
                    </div>

                    <!-- Scenario Panels -->
                    <div id="scenarioPanels">
                        <!-- Scenario A Panel (Default) -->
                        <div class="scenario-panel active" data-scenario="A">
                            <div class="scenario-panel-header">
                                <h3 class="scenario-panel-title">üìä Szenario A</h3>
                                <div class="scenario-actions">
                                    <button class="scenario-action-btn" onclick="renameScenario('A')" title="Szenario umbenennen">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                        Umbenennen
                                    </button>
                                    <button class="scenario-action-btn" onclick="copyScenario('A')" title="Szenario kopieren">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                        Kopieren
                                    </button>
                                </div>
                            </div>

                            <!-- Savings Rate Configuration -->
                            <div class="savings-configuration">
                                <div class="savings-mode-toggle" style="margin-bottom: 20px;">
                                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">üí∞ Sparraten-Konfiguration</label>
                                    <div class="savings-mode-buttons">
                                        <button type="button" class="savings-mode-btn active" data-mode="simple" data-scenario="A">
                                            <span class="mode-icon">üìà</span>
                                            <span class="mode-text">Einfache Sparrate</span>
                                        </button>
                                        <button type="button" class="savings-mode-btn" data-mode="multi-phase" data-scenario="A">
                                            <span class="mode-icon">üéØ</span>
                                            <span class="mode-text">Mehrphasig</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Simple Savings Rate (Default) -->
                                <div class="simple-savings-container" data-scenario="A">
                                    <div class="input-group">
                                        <label for="monthlySavings_A">Monatliche Sparrate (‚Ç¨)</label>
                                        <input type="text" id="monthlySavings_A" class="input-field scenario-input" value="500" step="10" data-scenario="A">
                                    </div>
                                </div>

                                <!-- Multi-Phase Savings Configuration -->
                                <div class="multi-phase-savings-container" data-scenario="A" style="display: none;">
                                    <div class="multi-phase-header">
                                        <h4 style="color: #2c3e50; margin-bottom: 15px;">üéØ Mehrphasige Sparplanung</h4>
                                        <p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 20px; line-height: 1.4;">
                                            Definieren Sie bis zu 3 verschiedene Sparphasen mit unterschiedlichen monatlichen Sparraten. 
                                            Perfekt f√ºr Lebensphasen wie Berufseinstieg, Karrieremitte und Spitzenverdienst.
                                        </p>
                                    </div>

                                    <div class="phases-container" data-scenario="A">
                                        <!-- Phase 1 (Always active) -->
                                        <div class="savings-phase active" data-phase="1" data-scenario="A">
                                            <div class="phase-header">
                                                <div class="phase-title">
                                                    <div class="phase-number">1</div>
                                                    <h5>Phase 1</h5>
                                                    <div class="phase-status-indicator active"></div>
                                                </div>
                                            </div>
                                            <div class="phase-content">
                                                <div class="phase-controls">
                                                    <div class="time-range-inputs">
                                                        <div class="input-group time-input">
                                                            <label>Von Jahr</label>
                                                            <input type="number" class="phase-start-year" value="0" min="0" readonly data-phase="1" data-scenario="A">
                                                        </div>
                                                        <div class="input-group time-input">
                                                            <label>Bis Jahr</label>
                                                            <input type="number" class="phase-end-year" value="10" min="1" max="100" data-phase="1" data-scenario="A">
                                                        </div>
                                                        <div class="input-group savings-input">
                                                            <label>Monatliche Sparrate (‚Ç¨)</label>
                                                            <input type="text" class="phase-savings-rate" value="300" data-phase="1" data-scenario="A">
                                                        </div>
                                                        <div class="input-group rendite-input">
                                                            <label>Rendite (% p.a.)</label>
                                                            <input type="text" class="phase-return-rate" value="7,0" inputmode="decimal" pattern="[0-9]+([.,][0-9]+)?" data-phase="1" data-scenario="A">
                                                        </div>
                                                    </div>
                                                    <div class="phase-summary">
                                                        <span class="phase-duration">Dauer: 11 Jahre</span>
                                                        <span class="phase-total">Gesamt: ‚Ç¨39.600</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Phase 2 -->
                                        <div class="savings-phase" data-phase="2" data-scenario="A">
                                            <div class="phase-header">
                                                <div class="phase-title">
                                                    <div class="phase-number">2</div>
                                                    <h5>Phase 2</h5>
                                                    <div class="phase-status-indicator"></div>
                                                </div>
                                                <button type="button" class="phase-toggle-btn" data-phase="2" data-scenario="A">
                                                    <span class="toggle-text">Aktivieren</span>
                                                </button>
                                            </div>
                                            <div class="phase-content" style="display: none;">
                                                <div class="phase-controls">
                                                    <div class="time-range-inputs">
                                                        <div class="input-group time-input">
                                                            <label>Von Jahr</label>
                                                            <input type="number" class="phase-start-year" value="11" min="1" data-phase="2" data-scenario="A">
                                                        </div>
                                                        <div class="input-group time-input">
                                                            <label>Bis Jahr</label>
                                                            <input type="number" class="phase-end-year" value="25" min="2" max="100" data-phase="2" data-scenario="A">
                                                        </div>
                                                        <div class="input-group savings-input">
                                                            <label>Monatliche Sparrate (‚Ç¨)</label>
                                                            <input type="text" class="phase-savings-rate" value="800" data-phase="2" data-scenario="A">
                                                        </div>
                                                        <div class="input-group rendite-input">
                                                            <label>Rendite (% p.a.)</label>
                                                            <input type="text" class="phase-return-rate" value="8,5" inputmode="decimal" pattern="[0-9]+([.,][0-9]+)?" data-phase="2" data-scenario="A">
                                                        </div>
                                                    </div>
                                                    <div class="phase-summary">
                                                        <span class="phase-duration">Dauer: 15 Jahre</span>
                                                        <span class="phase-total">Gesamt: ‚Ç¨144.000</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Phase 3 -->
                                        <div class="savings-phase" data-phase="3" data-scenario="A">
                                            <div class="phase-header">
                                                <div class="phase-title">
                                                    <div class="phase-number">3</div>
                                                    <h5>Phase 3</h5>
                                                    <div class="phase-status-indicator"></div>
                                                </div>
                                                <button type="button" class="phase-toggle-btn" data-phase="3" data-scenario="A">
                                                    <span class="toggle-text">Aktivieren</span>
                                                </button>
                                            </div>
                                            <div class="phase-content" style="display: none;">
                                                <div class="phase-controls">
                                                    <div class="time-range-inputs">
                                                        <div class="input-group time-input">
                                                            <label>Von Jahr</label>
                                                            <input type="number" class="phase-start-year" value="26" min="2" data-phase="3" data-scenario="A">
                                                        </div>
                                                        <div class="input-group time-input">
                                                            <label>Bis Jahr</label>
                                                            <input type="number" class="phase-end-year" value="40" min="3" max="100" data-phase="3" data-scenario="A">
                                                        </div>
                                                        <div class="input-group savings-input">
                                                            <label>Monatliche Sparrate (‚Ç¨)</label>
                                                            <input type="text" class="phase-savings-rate" value="1200" data-phase="3" data-scenario="A">
                                                        </div>
                                                        <div class="input-group rendite-input">
                                                            <label>Rendite (% p.a.)</label>
                                                            <input type="text" class="phase-return-rate" value="6,5" inputmode="decimal" pattern="[0-9]+([.,][0-9]+)?" data-phase="3" data-scenario="A">
                                                        </div>
                                                    </div>
                                                    <div class="phase-summary">
                                                        <span class="phase-duration">Dauer: 15 Jahre</span>
                                                        <span class="phase-total">Gesamt: ‚Ç¨216.000</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Multi-Phase Summary -->
                                    <div class="multi-phase-summary">
                                        <div class="summary-header">
                                            <h4>Sparplan-√úbersicht</h4>
                                        </div>
                                        <div class="summary-content">
                                            <div class="summary-item">
                                                <span class="summary-label">Aktive Phasen:</span>
                                                <span class="summary-value" id="activePhasesCount_A">1</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-label">Gesamtdauer:</span>
                                                <span class="summary-value" id="totalDuration_A">11 Jahre</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-label">Durchschnittliche Sparrate:</span>
                                                <span class="summary-value" id="averageSavingsRate_A">‚Ç¨300</span>
                                            </div>
                                            <div class="summary-item">
                                                <span class="summary-label">Gesamteinzahlungen:</span>
                                                <span class="summary-value" id="totalContributions_A">‚Ç¨39.600</span>
                                            </div>
                                        </div>
                                        <div class="phase-timeline" id="phaseTimeline_A">
                                            <!-- Visual timeline will be generated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="initialCapital_A">Startkapital (‚Ç¨)</label>
                                <input type="text" id="initialCapital_A" class="input-field scenario-input" value="3.000" step="100" data-scenario="A">
                            </div>

                            <!-- Tax Toggle -->
                            <div class="toggle-container" style="margin-bottom: 30px;">
                                <label>Deutsche Abgeltungssteuer einbeziehen (25% mit Vorabpauschale)</label>
                                <div class="toggle scenario-toggle active" id="taxToggle_A" data-scenario="A"></div>
                            </div>

                            <!-- ETF Type Selection -->
                            <div class="input-group" style="margin-top: 20px; margin-bottom: 25px;">
                                <label style="margin-bottom: 12px; display: block; font-weight: 600;">ETF-Typ f√ºr Steuerberechnung</label>
                                <div class="radio-group" style="margin-top: 10px;">
                                    <label class="radio-option">
                                        <input type="radio" name="etfType" value="accumulating" checked>
                                        <span class="radio-custom"></span>
                                        Thesaurierend (Vorabpauschale)
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="etfType" value="distributing">
                                        <span class="radio-custom"></span>
                                        Aussch√ºttend
                                    </label>
                                </div>
                                <small style="color: #7f8c8d; font-size: 0.85rem; margin-top: 12px; display: block; line-height: 1.4;">
                                    üí° Thesaurierende ETFs: Niedrigere Steuerlast durch Vorabpauschale. Aussch√ºttende ETFs: Steuern auf Dividenden.
                                </small>
                            </div>

                            <!-- Teilfreistellung Toggle -->
                            <div class="toggle-container" style="margin-top: 25px; margin-bottom: 30px;">
                                <label>Teilfreistellung bei Aktienfonds anwenden (30% steuerfrei)</label>
                                <div class="toggle scenario-toggle active" id="teilfreistellungToggle_A" data-scenario="A"></div>
                            </div>
                            <div style="margin-top: -15px; margin-bottom: 25px;" id="teilfreistellungHelp_A">
                                <small style="color: #7f8c8d; font-size: 0.85rem; display: block; line-height: 1.4;">
                                    üí° Bei Aktien-ETFs sind 30% der Ertr√§ge steuerfrei. Bei Renten-ETFs oder Mischfonds gelten andere S√§tze.
                                </small>
                            </div>

                            <!-- Sliders -->
                            <div class="input-group">
                                <label>J√§hrliche Rendite (%)</label>
                                <div class="slider-container">
                                    <input type="range" id="annualReturn_A" class="slider scenario-slider" min="1" max="50" value="7" step="0.1" data-scenario="A">
                                    <span class="slider-value" id="annualReturnValue_A">7.0%</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <label>Inflationsrate (%)</label>
                                <div class="slider-container">
                                    <input type="range" id="inflationRate_A" class="slider scenario-slider" min="0" max="6" value="2" step="0.1" data-scenario="A">
                                    <span class="slider-value" id="inflationRateValue_A">2.0%</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <label>J√§hrliche Gehaltssteigerung (%)</label>
                                <div class="slider-container">
                                    <input type="range" id="salaryGrowth_A" class="slider scenario-slider" min="0" max="8" value="3" step="0.1" data-scenario="A">
                                    <span class="slider-value" id="salaryGrowthValue_A">3.0%</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <label>Anlagedauer (Jahre)</label>
                                <div class="slider-container">
                                    <input type="range" id="duration_A" class="slider scenario-slider" min="1" max="50" value="25" step="1" data-scenario="A">
                                    <span class="slider-value" id="durationValue_A">25 Jahre</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="baseSalary_A">Aktuelles Brutto-Jahresgehalt (‚Ç¨)</label>
                                <input type="text" id="baseSalary_A" class="input-field scenario-input" value="60.000" step="1000" data-scenario="A">
                                <small style="color: #7f8c8d; font-size: 0.85rem; margin-top: 5px; display: block;">
                                    üí° Ben√∂tigt f√ºr realistische Gehaltssteigerungs-Berechnung
                                </small>
                            </div>

                            <div class="input-group">
                                <label>Gehaltssteigerung f√ºr Sparrate (%)</label>
                                <div class="slider-container">
                                    <input type="range" id="salaryToSavings_A" class="slider scenario-slider" min="0" max="100" value="50" step="5" data-scenario="A">
                                    <span class="slider-value" id="salaryToSavingsValue_A">50%</span>
                                </div>
                                <small style="color: #7f8c8d; font-size: 0.85rem; margin-top: 5px; display: block;">
                                    Wieviel % der <strong>Netto-Gehaltssteigerung</strong> flie√üt in die Sparrate?
                                </small>
                                <div style="background: #e8f4fd; border: 1px solid #3498db; border-radius: 6px; padding: 10px; margin-top: 8px; font-size: 0.8rem; color: #2c3e50;">
                                    üí° <strong>Realistische Berechnung:</strong> Ber√ºcksichtigt die deutsche progressive Besteuerung. Bei Gehaltssteigerungen steigt auch die Steuerlast, wodurch weniger Netto-Erh√∂hung f√ºr das Sparen verf√ºgbar ist.
                                </div>
                                
                                <!-- Salary Increase Analysis -->
                                <div id="salaryIncreaseAnalysis_A" class="salary-increase-analysis" style="background: #f0fff0; border: 1px solid #27ae60; border-radius: 8px; padding: 15px; margin-top: 10px; font-size: 0.9rem; color: #2c3e50;">
                                    <h4 style="margin: 0 0 10px 0; color: #27ae60; font-size: 1rem;">üìä Auswirkung der Gehaltserh√∂hung</h4>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                        <div>
                                            <strong>Brutto-Erh√∂hung:</strong><br>
                                            <span class="gross-increase">‚Ç¨1.800</span>
                                        </div>
                                        <div>
                                            <strong>Netto-Erh√∂hung:</strong><br>
                                            <span class="net-increase" style="color: #27ae60; font-weight: bold;">‚Ç¨1.100</span>
                                        </div>
                                        <div>
                                            <strong>Steuer/Abgaben auf Erh√∂hung:</strong><br>
                                            <span class="tax-on-increase" style="color: #e74c3c;">‚Ç¨700</span>
                                        </div>
                                        <div>
                                            <strong>Netto-Rate der Erh√∂hung:</strong><br>
                                            <span class="net-increase-rate" style="color: #f39c12; font-weight: bold;">61.1%</span>
                                        </div>
                                    </div>
                                    <div style="margin-top: 10px; padding: 8px; background: #fff; border-radius: 4px; font-size: 0.8rem; color: #7f8c8d;">
                                        üí° Bei h√∂heren Geh√§ltern bleibt prozentual weniger netto √ºbrig (progressive Besteuerung)
                                    </div>
                                </div>
                            </div>

                            
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="results-section">
                    <h2 class="section-title">Szenario-Vergleich</h2>

                    <!-- Scenario Results -->
                    <div class="scenario-results" id="scenarioResults">
                        <!-- Results will be populated dynamically -->
                    </div>


                </div>
            </div>

            <!-- Chart Section at Bottom -->
            <div class="chart-section" id="accumulationChart">
                <h2 class="section-title">Verm√∂gensentwicklung √ºber die Zeit</h2>
                
                <!-- Chart View Toggle -->
                <div class="chart-toggle" style="margin-bottom: 20px; text-align: center;">
                    <button class="chart-toggle-btn active" id="scenarioComparisonBtn">üìä Szenario-Vergleich</button>
                    <button class="chart-toggle-btn" id="contributionsGainsBtn">üí∞ Einzahlungen vs. Gewinne</button>
                </div>

                <!-- Scenario Selection Checkboxes (for scenario comparison mode) -->
                <div id="scenarioCheckboxes" style="margin-bottom: 20px; text-align: center; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;">
                    <!-- Scenario checkboxes will be dynamically generated by JavaScript -->
                </div>

                <!-- Scenario Selection Dropdown (for contributions vs gains mode) -->
                <div id="contributionsScenarioSelector" style="margin-bottom: 20px; text-align: center; display: none;">
                    <label for="contributionsScenarioDropdown" style="margin-right: 10px; font-weight: 600; color: #2c3e50;">Szenario ausw√§hlen:</label>
                    <select id="contributionsScenarioDropdown" style="padding: 8px 12px; border: 1px solid #bdc3c7; border-radius: 5px; font-size: 0.9rem; background: white; min-width: 140px; font-weight: bold;">
                        <!-- Options will be dynamically generated by JavaScript -->
                    </select>
                </div>

                
                <!-- Accumulation Chart View -->
                <div id="separateChartsView" class="chart-container">
                    <canvas id="wealthChart"></canvas>
                </div>
            </div>

            <!-- Withdrawal Section -->
            <div class="withdrawal-section" id="withdrawalSection" style="display: none;">
                <h2 class="section-title">Entnahmephase Konfiguration</h2>
                
                <!-- Entnahmephase Scenario Controls -->
                <div class="scenario-controls">
                    <button class="scenario-button" id="saveEntnahmephaseScenario">üíæ Szenario speichern</button>
                    <button class="scenario-button" id="manageEntnahmephaseScenarios">üóÇÔ∏è Szenarien verwalten</button>
                    <button class="scenario-button" id="resetEntnahmephaseScenario">üîÑ Zur√ºcksetzen</button>
                </div>
                
                <div class="withdrawal-grid">
                    <!-- Withdrawal Parameters -->
                    <div class="controls-section">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">Entnahmeparameter</h3>
                        
                        <div class="input-group">
                            <label for="retirementCapital">Verf√ºgbares Kapital bei Renteneintritt (‚Ç¨)</label>
                            <input type="text" id="retirementCapital" class="input-field" value="1.000.000" step="1000">
                            <div id="syncIndicator" style="margin-top: 8px; padding: 8px 12px; background: rgba(52, 152, 219, 0.1); border: 1px solid rgba(52, 152, 219, 0.3); border-radius: 6px; font-size: 0.85rem; color: #2c3e50; display: none; transition: all 0.3s ease;">
                                <span id="syncIcon" style="color: #3498db; transition: transform 0.5s ease;">üîÑ</span> <strong>Auto-Sync:</strong> Synchronisiert mit <span id="syncScenarioName">Szenario A</span>
                            </div>
                            <div style="margin-top: 10px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <select id="scenarioSelector" style="padding: 8px 12px; border: 1px solid #bdc3c7; border-radius: 5px; font-size: 0.9rem; background: white; min-width: 140px;">
                                    <option value="">Szenario w√§hlen...</option>
                                </select>
                                <button type="button" id="useAccumulationResult" style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem; flex-shrink: 0;">üìä Wert √ºbernehmen</button>
                                <button type="button" id="manualSyncBtn" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem; flex-shrink: 0;" title="Aktuelles Szenario synchronisieren">üîÑ Auto-Sync</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>Entnahmedauer (Jahre)</label>
                            <div class="slider-container">
                                <input type="range" id="withdrawalDuration" class="slider" min="10" max="60" value="25" step="1">
                                <span class="slider-value" id="withdrawalDurationValue">25 Jahre</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>J√§hrliche Rendite im Ruhestand (%)</label>
                            <div class="slider-container">
                                <input type="range" id="postRetirementReturn" class="slider" min="1" max="15" value="5" step="0.1">
                                <span class="slider-value" id="postRetirementReturnValue">5.0%</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>Inflationsrate (%)</label>
                            <div class="slider-container">
                                <input type="range" id="withdrawalInflation" class="slider" min="0" max="5" value="2" step="0.1">
                                <span class="slider-value" id="withdrawalInflationValue">2.0%</span>
                            </div>
                        </div>



                        <div class="toggle-container">
                            <label>Abgeltungssteuer anwenden (25%)</label>
                            <div class="toggle" id="withdrawalTaxToggle"></div>
                        </div>

                        <div class="input-group" id="teilfreistellungGroup" style="display: none;">
                            <label>Teilfreistellung (%)</label>
                            <div class="slider-container">
                                <input type="range" id="withdrawalTeilfreistellungRate" class="slider" min="0" max="30" value="30" step="1">
                                <span class="slider-value" id="withdrawalTeilfreistellungRateValue">30%</span>
                            </div>
                            <div class="help-text" style="font-size: 0.85rem; color: #7f8c8d; margin-top: 5px;">
                                Equity ETFs: 30% | Mixed Funds: 15% | Bond ETFs: 0%
                            </div>
                        </div>
                    </div>

                    <!-- Withdrawal Results -->
                    <div class="results-section">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">Entnahmeergebnisse</h3>
                        
                        <div class="results-grid" style="grid-template-columns: 1fr;">
                            <div class="result-card">
                                <h3>Monatliche Brutto-Entnahme</h3>
                                <div class="result-value" id="monthlyWithdrawal">‚Ç¨0</div>
                            </div>
                            <div class="result-card">
                                <h3>Monatliche Netto-Entnahme</h3>
                                <div class="result-value" id="monthlyNetWithdrawal">‚Ç¨0</div>
                            </div>
                            <div class="result-card">
                                <h3>Gesamte Steuerlast</h3>
                                <div class="result-value" id="totalTaxesPaid">‚Ç¨0</div>
                            </div>
                            <div class="result-card">
                                <h3>Reale Kaufkraft (heute)</h3>
                                <div class="result-value" id="realPurchasingPower">‚Ç¨0</div>
                            </div>
                        </div>

                        <div class="tax-info">
                            <h4>üá©üá™ Deutsche Steuerregelung bei ETF-Entnahmen</h4>
                            <p><strong>Sparerpauschbetrag:</strong> ‚Ç¨1.000 j√§hrlich steuerfrei (‚Ç¨2.000 bei Verheirateten)</p>
                            <p><strong>Besteuerung:</strong> Nur realisierte Gewinne werden mit 25% besteuert</p>
                            <p><strong>FIFO-Prinzip:</strong> First-In-First-Out bei der Gewinnermittlung</p>
                            <p><strong>Vorabpauschale:</strong> J√§hrliche Besteuerung thesaurierender ETFs basierend auf Basiszins (2,53% f√ºr 2025)</p>
                            
                            <h4 style="margin-top: 15px;">üí° Steueroptimierungsstrategien</h4>
                            <p><strong>1. Entnahme-Timing:</strong> Sparerpauschbetrag j√§hrlich vollst√§ndig aussch√∂pfen</p>
                            <p><strong>2. Ehepartner-Splitting:</strong> Depots auf beide Partner verteilen (je ‚Ç¨1.000 Freibetrag)</p>
                            <p><strong>3. Gestaffelte Entnahmen:</strong> Verluste mit Gewinnen verrechnen</p>
                            <p><strong>4. Alt-Anteile vor 2009:</strong> Nach 1 Jahr Haltefrist steuerfrei</p>
                            <p><strong>5. ETF-Typ w√§hlen:</strong> Thesaurierende ETFs haben niedrigere laufende Steuerlast durch Vorabpauschale</p>
                        </div>
                    </div>
                </div>

                <!-- Chart View Toggle -->
                <div class="chart-toggle" style="margin-top: 30px; margin-bottom: 20px; text-align: center;">
                    <button class="chart-toggle-btn active" id="withdrawalChartBtn">üìä Entnahme-Verlauf</button>
                    <button class="chart-toggle-btn" id="integratedTimelineBtn">üîÑ Integrierte Zeitleiste</button>
                </div>
                
                <!-- Withdrawal Chart -->
                <div id="withdrawalChartView" class="chart-container">
                    <canvas id="withdrawalChart"></canvas>
                </div>
                
                <!-- Integrated Timeline View -->
                <div id="integratedTimelineView" class="chart-container" style="display: none;">
                    <canvas id="integratedChart"></canvas>
                    <div class="timeline-info">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <div style="flex: 1; min-width: 120px;">
                                <strong>üìà Ansparphase:</strong> <span id="accumulationYears">0</span> Jahre
                            </div>
                            <div style="font-size: 1.5rem; color: #3498db; flex-shrink: 0;">‚Üí</div>
                            <div style="flex: 1; min-width: 120px; text-align: right;">
                                <strong>üèñÔ∏è Entnahmephase:</strong> <span id="withdrawalYears">0</span> Jahre
                            </div>
                        </div>
                        <div style="text-align: center; font-weight: bold; color: #e74c3c;">
                            √úbergang bei: ‚Ç¨<span id="transitionCapital">0</span>
                        </div>
                    </div>
                </div>

                <!-- Withdrawal Table -->
                <div class="withdrawal-table">
                    <table id="withdrawalTable">
                        <thead>
                            <tr>
                                <th>Jahr</th>
                                <th>Kapital Beginn</th>
                                <th>J√§hrliche Entnahme</th>
                                <th>Steuern</th>
                                <th>Netto-Entnahme</th>
                                <th>Kapital Ende</th>
                                <th>Realer Wert</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Scenario Comparison Section -->
            <div class="scenario-comparison-section" id="scenarioComparisonSection" style="display: none;">
                <h2 class="section-title">üîç Umfassender Szenario-Vergleich</h2>

                <div class="comparison-top-controls">
                    <div class="scenario-chooser">
                        <button class="btn-scenario active" data-scenario="optimistic">üéØ Optimistisch</button>
                        <button class="btn-scenario" data-scenario="conservative">üõ°Ô∏è Konservativ</button>
                        <button class="btn-scenario btn-new">+ Neues Szenario</button>
                    </div>
                    <div class="action-buttons">
                        <button class="comparison-btn btn-load">üìã Vorlage laden</button>
                        <button class="comparison-btn btn-save">üíæ Konfiguration speichern</button>
                        <button class="comparison-btn btn-export">üìä Export</button>
                    </div>
                </div>

                <!-- Layout -->
                <div class="comparison-layout" id="comparisonLayout">
                    <!-- Left: Parameters -->
                    <div class="comparison-params-panel">
                        <div class="phase-pills" id="comparisonPhasePills">
                            <button class="pill active" data-target="budget">Budget</button>
                            <button class="pill" data-target="accumulation">Ansparphase</button>
                            <button class="pill" data-target="withdrawal">Entnahmephase</button>
                        </div>

                        <!-- Budget Section -->
                        <div class="param-section" id="comparisonBudgetSection">
                            <div class="param-header" data-toggle="budgetGrid">
                                <h4>üíº Budgetplanung</h4>
                                <div class="header-actions">
                                    <button class="btn-import">Importieren ‚ñº</button>
                                    <span class="toggle-icon">‚ñº</span>
                                </div>
                            </div>
                            <div class="param-grid active" id="budgetGrid">
                                <div class="field">
                                    <label>Einkommen (‚Ç¨/Monat)</label>
                                    <input class="input-field" type="number" placeholder="4000" />
                                </div>
                                <div class="field">
                                    <label>Ausgaben (‚Ç¨/Monat)</label>
                                    <input class="input-field" type="number" placeholder="3000" />
                                </div>
                                <div class="field">
                                    <label>Sparrate (‚Ç¨)</label>
                                    <input class="input-field" type="number" placeholder="1000" />
                                </div>
                                <div class="field">
                                    <label>Inflation p.a. (%)</label>
                                    <input class="input-field" type="number" placeholder="2.2" />
                                </div>
                                <div class="field">
                                    <label>Lohnwachstum p.a. (%)</label>
                                    <input class="input-field" type="number" placeholder="1.5" />
                                </div>
                            </div>
                        </div>

                        <!-- Accumulation Section -->
                        <div class="param-section" id="comparisonAccumSection">
                            <div class="param-header" data-toggle="accumGrid">
                                <h4>üìà Ansparphase</h4>
                                <div class="header-actions">
                                    <button class="btn-import">Importieren ‚ñº</button>
                                    <span class="toggle-icon">‚ñº</span>
                                </div>
                            </div>
                            <div class="param-grid" id="accumGrid">
                                <div class="field">
                                    <label>Rendite p.a. (%)</label>
                                    <input class="input-field" type="number" placeholder="8.5" />
                                </div>
                                <div class="field">
                                    <label>Dauer (Jahre)</label>
                                    <input class="input-field" type="number" placeholder="30" />
                                </div>
                                <div class="field">
                                    <label>Einmalanlage (‚Ç¨)</label>
                                    <input class="input-field" type="number" placeholder="10000" />
                                </div>
                                <div class="field">
                                    <label>Monatliche Sparrate (‚Ç¨)</label>
                                    <input class="input-field" type="number" placeholder="1000" />
                                </div>
                            </div>
                        </div>

                        <!-- Withdrawal Section -->
                        <div class="param-section" id="comparisonWithdrawSection">
                            <div class="param-header" data-toggle="withdrawGrid">
                                <h4>üèñÔ∏è Entnahmephase</h4>
                                <div class="header-actions">
                                    <button class="btn-import">Importieren ‚ñº</button>
                                    <span class="toggle-icon">‚ñº</span>
                                </div>
                            </div>
                            <div class="param-grid" id="withdrawGrid">
                                <div class="field">
                                    <label>Entnahmerate (%)</label>
                                    <input class="input-field" type="number" placeholder="4" />
                                </div>
                                <div class="field">
                                    <label>Dauer (Jahre)</label>
                                    <input class="input-field" type="number" placeholder="30" />
                                </div>
                                <div class="field">
                                    <label>Steuersatz KapESt (%)</label>
                                    <input class="input-field" type="number" placeholder="26.375" />
                                </div>
                                <div class="field">
                                    <label>Teilfreistellung (%)</label>
                                    <input class="input-field" type="number" placeholder="30" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Results -->
                    <div class="comparison-results-panel">
                        <!-- Scenario summary cards -->
                        <h3>üèÜ Szenario-√úbersicht</h3>
                        <div class="summary-cards">
                            <div class="summary-card primary">
                                <h4>üéØ Optimistisch</h4>
                                <div class="kv-container">
                                    <div class="kv">
                                        <span class="k">Endverm√∂gen</span><span class="v">1.2 Mio ‚Ç¨</span>
                                        <span class="k">√ò Rendite</span><span class="v">8.5%</span>
                                        <span class="k">Sparrate (‚Ç¨)</span><span class="v">1.000 ‚Ç¨</span>
                                        <span class="k">Entnahmerate</span><span class="v">4%</span>
                                    </div>
                                    <div class="kv">
                                        <span class="k">Ansparphase (in Jahre)</span><span class="v">30</span>
                                        <span class="k">Entnahmedauer (in Jahre)</span><span class="v">25</span>
                                        <span class="k">Risikoprofil</span><span class="v">Hoch</span>
                                    </div>
                                </div>
                            </div>
                            <div class="summary-card success">
                                <h4>üõ°Ô∏è Konservativ</h4>
                                <div class="kv-container">
                                    <div class="kv">
                                        <span class="k">Endverm√∂gen</span><span class="v">800k ‚Ç¨</span>
                                        <span class="k">√ò Rendite</span><span class="v">5.5%</span>
                                        <span class="k">Sparrate (‚Ç¨)</span><span class="v">500 ‚Ç¨</span>
                                        <span class="k">Entnahmerate</span><span class="v">3%</span>
                                    </div>
                                    <div class="kv">
                                        <span class="k">Ansparphase (in Jahre)</span><span class="v">25</span>
                                        <span class="k">Entnahmedauer (in Jahre)</span><span class="v">30</span>
                                        <span class="k">Risikoprofil</span><span class="v">Niedrig</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chart Controls -->
                        <div class="chart-controls-bar">
                            <div class="view-pills" id="comparisonChartViews">
                                <button class="chart-view-btn active" data-view="lifecycle">üîÑ Lebenszyklus</button>
                                <button class="chart-view-btn" data-view="accumulation">üìà Ansparphase</button>
                                <button class="chart-view-btn" data-view="withdrawal">üèñÔ∏è Entnahmephase</button>
                                <button class="chart-view-btn" data-view="metrics">üéØ Kennzahlen Radar</button>
                            </div>
                            <div class="scenario-visibility">
                                <label><input type="checkbox" checked />üéØ Optimistisch</label>
                                <label><input type="checkbox" checked />üõ°Ô∏è Konservativ</label>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="comparison-chart-view active" id="comparisonLifecycleView">
                            <canvas id="comparisonLifecycleChart"></canvas>
                        </div>
                        <div class="comparison-chart-view" id="comparisonAccumulationView">
                            <canvas id="comparisonAccumulationChart"></canvas>
                        </div>
                        <div class="comparison-chart-view" id="comparisonWithdrawalView">
                            <canvas id="comparisonWithdrawalChart"></canvas>
                        </div>
                        <div class="comparison-chart-view" id="comparisonMetricsView">
                            <canvas id="comparisonMetricsChart"></canvas>
                        </div>

                        <!-- Parameter Comparison Table -->
                        <div class="comparison-table-wrapper">
                            <div class="table-filters" id="comparisonTableFilters">
                                <button class="filter-btn active" data-category="all">Alle</button>
                                <button class="filter-btn" data-category="budget">Budget</button>
                                <button class="filter-btn" data-category="accumulation">Ansparphase</button>
                                <button class="filter-btn" data-category="withdrawal">Entnahmephase</button>
                                <button class="filter-btn" data-category="results">Ergebnisse</button>
                            </div>
                            <div class="table-content">
                                <table id="comparisonTable">
                                    <thead>
                                        <tr>
                                            <th>Parameter</th>
                                            <th>üéØ Optimistisch</th>
                                            <th>üõ°Ô∏è Konservativ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Budget Group -->
                                        <tr class="group-header" data-category-group="budget">
                                            <th colspan="3">Budget</th>
                                        </tr>
                                        <tr data-category="budget">
                                            <td>Einkommen (‚Ç¨/Monat)</td>
                                            <td>4000</td>
                                            <td>3500</td>
                                        </tr>
                                        <tr data-category="budget">
                                            <td>Ausgaben (‚Ç¨/Monat)</td>
                                            <td>3000</td>
                                            <td>2800</td>
                                        </tr>
                                        <tr data-category="budget">
                                            <td>Sparrate (‚Ç¨)</td>
                                            <td>1.000</td>
                                            <td>500</td>
                                        </tr>
                                        <tr data-category="budget">
                                            <td>Inflation p.a. (%)</td>
                                            <td>2.2%</td>
                                            <td>2.2%</td>
                                        </tr>
                                        
                                        <!-- Accumulation Group -->
                                        <tr class="group-header" data-category-group="accumulation">
                                            <th colspan="3">Ansparphase</th>
                                        </tr>
                                        <tr data-category="accumulation">
                                            <td>Rendite p.a. (%)</td>
                                            <td>8.5%</td>
                                            <td>5.5%</td>
                                        </tr>
                                        <tr data-category="accumulation">
                                            <td>Dauer (Jahre)</td>
                                            <td>30</td>
                                            <td>25</td>
                                        </tr>
                                        <tr data-category="accumulation">
                                            <td>Monatl. Sparrate (‚Ç¨)</td>
                                            <td>1,000</td>
                                            <td>500</td>
                                        </tr>
                                        
                                        <!-- Withdrawal Group -->
                                        <tr class="group-header" data-category-group="withdrawal">
                                            <th colspan="3">Entnahmephase</th>
                                        </tr>
                                        <tr data-category="withdrawal">
                                            <td>Entnahmerate (%)</td>
                                            <td>4%</td>
                                            <td>3%</td>
                                        </tr>
                                        <tr data-category="withdrawal">
                                            <td>Dauer (Jahre)</td>
                                            <td>25</td>
                                            <td>30</td>
                                        </tr>

                                        <!-- Results Group -->
                                        <tr class="group-header" data-category-group="results">
                                            <th colspan="3">Ergebnisse</th>
                                        </tr>
                                        <tr data-category="results">
                                            <td>Endverm√∂gen</td>
                                            <td>1.2 Mio ‚Ç¨</td>
                                            <td>800k ‚Ç¨</td>
                                        </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Full Summary -->
                <div class="comparison-full-summary">
                    <h3>üìå Zusammenfassung & Empfehlungen</h3>
                    <p>Das optimistische Szenario maximiert das erwartete Endverm√∂gen bei h√∂herer Volatilit√§t und Drawdown-Risiko; das konservative priorisiert Stabilit√§t und eine h√∂here Erfolgswahrscheinlichkeit in langen Entnahmephasen. Eine ausgewogene Allokation mit situativem Rebalancing, moderater Entnahmerate (3.5‚Äì4%) und inflationsadjustierter Planung liefert robuste Ergebnisse √ºber verschiedene Marktregime.</p>
                </div>
            </div>

        </div>
    </div>
    <!-- Save Ansparphase Scenario Modal -->
    <div id="saveAnsparphaseScenarioModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2 class="profile-modal-title">üíæ Ansparphase-Szenario speichern</h2>
                <span class="profile-close" id="closeSaveAnsparphaseScenarioModal">&times;</span>
            </div>
            <div class="save-profile-form">
                <div class="form-group">
                    <label for="ansparphaseScenarioName" class="form-label">Szenario-Name</label>
                    <input type="text" id="ansparphaseScenarioName" class="form-input" placeholder="z.B. Konservative Ansparphase" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="ansparphaseScenarioDescription" class="form-label">Beschreibung (optional)</label>
                    <textarea id="ansparphaseScenarioDescription" class="form-textarea" placeholder="Beschreibung der Ansparphase-Konfiguration..."></textarea>
                </div>
                <div class="info-box">
                    <h4>üìä Szenario-Vorschau</h4>
                    <div class="profile-preview" id="ansparphaseScenarioPreview">
                        <!-- Preview will be populated by JavaScript -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="action-btn cancel-btn" id="cancelSaveAnsparphaseScenario">Abbrechen</button>
                    <button class="action-btn save-btn" id="confirmSaveAnsparphaseScenario" disabled>Speichern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Ansparphase Scenario Modal -->
    <div id="loadAnsparphaseScenarioModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2 class="profile-modal-title">üìÇ Ansparphase-Szenario laden</h2>
                <span class="profile-close" id="closeLoadAnsparphaseScenarioModal">&times;</span>
            </div>
            <div class="load-profile-content">
                <div class="info-box">
                    <h4>üìã Verf√ºgbare Ansparphase-Szenarien</h4>
                    <p>W√§hlen Sie ein oder mehrere gespeicherte Szenarien aus um sie zu laden.</p>
                    <div style="margin-top: 10px;">
                        <button class="action-btn secondary-btn" onclick="selectAllScenariosForLoad()" style="margin-right: 10px; padding: 5px 10px; font-size: 0.8rem;">‚úÖ Alle ausw√§hlen</button>
                        <button class="action-btn secondary-btn" onclick="clearAllScenariosForLoad()" style="padding: 5px 10px; font-size: 0.8rem;">‚ùå Auswahl l√∂schen</button>
                    </div>
                </div>
                <div class="profile-list" id="loadAnsparphaseScenarioList">
                    <!-- Scenarios will be populated by JavaScript -->
                </div>
                <div class="info-box" id="loadScenarioPreviewContainer" style="display: none;">
                    <h4>üìä Szenario-Vorschau</h4>
                    <div id="loadScenarioPreview">
                        <!-- Preview will be populated by JavaScript -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="action-btn cancel-btn" id="cancelLoadAnsparphaseScenario">Abbrechen</button>
                    <button class="action-btn save-btn" id="confirmLoadAnsparphaseScenario" disabled>Laden</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Ansparphase Scenarios Modal -->
    <div id="manageAnsparphaseScenarioModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2 class="profile-modal-title">üóÇÔ∏è Ansparphase-Szenarien verwalten</h2>
                <span class="profile-close" id="closeManageAnsparphaseScenarioModal">&times;</span>
            </div>
            <div class="profile-list" id="manageAnsparphaseScenarioList">
                <!-- Scenarios will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Entnahmephase Scenario Modals -->
    <!-- Save Entnahmephase Scenario Modal -->
    <div id="saveEntnahmephaseScenarioModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2 class="profile-modal-title">üíæ Entnahmephase-Szenario speichern</h2>
                <span class="profile-close" id="closeSaveEntnahmephaseScenarioModal">&times;</span>
            </div>
            <div class="save-profile-form">
                <div class="form-group">
                    <label for="entnahmephaseScenarioName" class="form-label">Szenario-Name</label>
                    <input type="text" id="entnahmephaseScenarioName" class="form-input" placeholder="z.B. Konservative Entnahme" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="entnahmephaseScenarioDescription" class="form-label">Beschreibung (optional)</label>
                    <textarea id="entnahmephaseScenarioDescription" class="form-textarea" placeholder="Beschreibung der Entnahmephase-Konfiguration..."></textarea>
                </div>
                <div class="info-box">
                    <h4>üìä Szenario-Vorschau</h4>
                    <div class="profile-preview" id="entnahmephaseScenarioPreview">
                        <!-- Preview will be populated by JavaScript -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="action-btn cancel-btn" id="cancelSaveEntnahmephaseScenario">Abbrechen</button>
                    <button class="action-btn save-btn" id="confirmSaveEntnahmephaseScenario" disabled>Speichern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Entnahmephase Scenario Modal -->
    <div id="loadEntnahmephaseScenarioModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2 class="profile-modal-title">üìÇ Entnahmephase-Szenario laden</h2>
                <span class="profile-close" id="closeLoadEntnahmephaseScenarioModal">&times;</span>
            </div>
            <div class="load-profile-content">
                <div class="info-box">
                    <h4>üìã Verf√ºgbare Entnahmephase-Szenarien</h4>
                    <p>W√§hlen Sie ein gespeichertes Szenario aus um es zu laden.</p>
                </div>
                <div class="profile-list" id="loadEntnahmephaseScenarioList">
                    <!-- Scenarios will be populated by JavaScript -->
                </div>
                <div class="modal-actions">
                    <button class="action-btn cancel-btn" id="cancelLoadEntnahmephaseScenario">Abbrechen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Entnahmephase Scenarios Modal -->
    <div id="manageEntnahmephaseScenarioModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2 class="profile-modal-title">üóÇÔ∏è Entnahmephase-Szenarien verwalten</h2>
                <span class="profile-close" id="closeManageEntnahmephaseScenarioModal">&times;</span>
            </div>
            <div class="profile-list" id="manageEntnahmephaseScenarioList">
                <!-- Scenarios will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Profile Management Modal -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h3 class="profile-modal-title">üóÇÔ∏è Profile verwalten</h3>
                <button class="profile-close" id="closeProfileModal">&times;</button>
            </div>
            <div id="profileList" class="profile-list">
                <!-- Profiles will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <!-- Save Profile Modal -->
    <div id="saveProfileModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h3 class="profile-modal-title">üíæ Profil speichern</h3>
                <button class="profile-close" id="closeSaveProfileModal">&times;</button>
            </div>
            <div class="save-profile-form">
                <div class="form-group">
                    <label for="profileName" class="form-label">üìù Profilname</label>
                    <input type="text" id="profileName" class="form-input" placeholder="z.B. Mein ETF-Plan 2025" maxlength="50">
                    <div class="form-hint">Geben Sie einen aussagekr√§ftigen Namen f√ºr Ihr Profil ein</div>
                </div>
                
                <div class="form-group">
                    <label for="profileDescription" class="form-label">üìÑ Beschreibung (optional)</label>
                    <textarea id="profileDescription" class="form-textarea" placeholder="z.B. Konservative Strategie mit 7% Rendite" maxlength="200" rows="3"></textarea>
                    <div class="form-hint">Kurze Beschreibung der Anlagestrategie oder Besonderheiten</div>
                </div>

                <div class="profile-preview">
                    <h4 class="preview-title">üìä Profil-Vorschau</h4>
                    <div class="preview-content" id="profilePreview">
                        <!-- Profile preview will be generated here -->
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="action-btn cancel-btn" id="cancelSaveProfile">‚ùå Abbrechen</button>
                    <button class="action-btn save-btn" id="confirmSaveProfile">üíæ Speichern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Profile Modal -->
    <div id="loadProfileModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h3 class="profile-modal-title">üìÇ Profil laden</h3>
                <button class="profile-close" id="closeLoadProfileModal">&times;</button>
            </div>
            <div class="load-profile-content">
                <div class="load-profile-info">
                    <div class="info-box">
                        <h4>‚ÑπÔ∏è Profil laden</h4>
                        <p>W√§hlen Sie ein gespeichertes Profil aus, um alle Einstellungen zu √ºbernehmen. Ihre aktuellen Eingaben werden dabei √ºberschrieben.</p>
                    </div>
                </div>
                
                <div id="loadProfileList" class="profile-list">
                    <!-- Available profiles will be loaded here -->
                </div>

                <div class="modal-actions">
                    <button class="action-btn cancel-btn" id="cancelLoadProfile">‚ùå Abbrechen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Disclaimer Footer -->
    <footer class="disclaimer-footer">
        <div class="kleingedrucktes">
            <strong>Haftungsausschluss:</strong> Dieser Rechner stellt Sch√§tzungen basierend auf den angegebenen Eingaben dar. Tats√§chliche Anlagerenditen k√∂nnen erheblich variieren. Vergangene Wertentwicklung ist kein Indikator f√ºr zuk√ºnftige Ergebnisse. Bitte konsultieren Sie einen Finanzberater f√ºr eine pers√∂nliche Anlageberatung.
        </div>
    </footer>

</body>
</html>
